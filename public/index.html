<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SnowSkye AI</title>

<style>

body{
font-family: Arial;
background:#f4f6fb;
}

/* Floating button */
#toggleBtn{
position:fixed;
bottom:20px;
right:20px;
width:60px;
height:60px;
border-radius:50%;
background:#2563eb;
color:white;
border:none;
font-size:24px;
cursor:pointer;
box-shadow:0 4px 12px rgba(0,0,0,0.3);
}

/* Chat box */
#chatBox{
position:fixed;
bottom:90px;
right:20px;
width:350px;
height:500px;
background:#0f172a;
border-radius:12px;
display:none;
flex-direction:column;
overflow:hidden;
box-shadow:0 8px 25px rgba(0,0,0,0.3);
}

/* Header */
#header{
background:#2563eb;
color:white;
padding:12px;
font-weight:bold;
display:flex;
align-items:center;
gap:10px;
}

#logo{
width:30px;
height:30px;
border-radius:50%;
}

/* Messages */
#messages{
flex:1;
padding:10px;
overflow-y:auto;
}

.msg{
margin:8px 0;
padding:10px;
border-radius:10px;
max-width:80%;
}

.user{
background:#2563eb;
color:white;
margin-left:auto;
}

.bot{
background:#1e293b;
color:white;
}

/* typing */
.typing{
font-style:italic;
opacity:0.7;
}

/* input area */
#inputArea{
display:flex;
}

#input{
flex:1;
padding:10px;
border:none;
outline:none;
}

button{
border:none;
padding:10px;
cursor:pointer;
}

#mic{
background:#10b981;
color:white;
}

#send{
background:#2563eb;
color:white;
}

</style>

</head>
<body>


<button id="toggleBtn">ðŸ’¬</button>


<div id="chatBox">

<div id="header">
<img id="logo" src="logo.png">
SnowSkye AI
</div>

<div id="messages"></div>

<div id="inputArea">
<input id="input" placeholder="Type message...">
<button id="mic">ðŸŽ¤</button>
<button id="send">Send</button>
</div>

</div>


<script>

const toggleBtn = document.getElementById("toggleBtn");
const chatBox = document.getElementById("chatBox");
const messages = document.getElementById("messages");
const input = document.getElementById("input");

let welcomed = false;


// Toggle chat open/close
toggleBtn.onclick = () => {

chatBox.style.display =
chatBox.style.display === "flex" ? "none" : "flex";

if(chatBox.style.display === "flex" && !welcomed){

welcomeMessage();
welcomed = true;

}

};


// Welcome message
function welcomeMessage(){

setTimeout(()=>{

addMessage(
"Hello ðŸ‘‹ I'm SnowSkye AI. How can I help you today?",
"bot"
);

speak(
"Hello. I'm SnowSkye AI. How can I help you today?"
);

},500);

}


// Add message to UI
function addMessage(text,type){

const div = document.createElement("div");

div.className = "msg " + type;

div.innerText = text;

messages.appendChild(div);

messages.scrollTop = messages.scrollHeight;

}


// typing animation
function showTyping(){

const div = document.createElement("div");

div.className = "msg bot typing";

div.id = "typing";

div.innerText = "SnowSkye AI is typing...";

messages.appendChild(div);

messages.scrollTop = messages.scrollHeight;

}


// remove typing
function removeTyping(){

const typing = document.getElementById("typing");

if(typing) typing.remove();

}


// Natural voice
function speak(text){

speechSynthesis.cancel();

const speech = new SpeechSynthesisUtterance(text);

speech.lang = "en-US";
speech.rate = 0.95;
speech.pitch = 1;
speech.volume = 1;

const voices = speechSynthesis.getVoices();

const preferredVoice =
voices.find(v => v.name.includes("Google US English")) ||
voices.find(v => v.name.includes("Samantha")) ||
voices.find(v => v.name.includes("Jenny")) ||
voices[0];

if(preferredVoice)
speech.voice = preferredVoice;

speechSynthesis.speak(speech);

}


// Backup reply
function backupReply(){

const reply =
"I'm sorry, I'm having trouble responding right now. Please try again in a moment.";

addMessage(reply,"bot");

speak(reply);

}


// Send message to backend
async function sendMessage(){

const text = input.value.trim();

if(!text) return;

addMessage(text,"user");

input.value="";

showTyping();

try{

const controller = new AbortController();

const timeout = setTimeout(()=>controller.abort(),10000);

const res = await fetch("/chat",{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({
message:text
}),

signal: controller.signal

});

clearTimeout(timeout);

const data = await res.json();

removeTyping();

if(!data || !data.reply){

backupReply();
return;

}

addMessage(data.reply,"bot");

speak(data.reply);

}
catch(error){

removeTyping();

backupReply();

}

}


// Send button
document.getElementById("send").onclick = sendMessage;


// Enter key support
input.addEventListener("keypress",function(e){

if(e.key==="Enter")
sendMessage();

});


// Voice input
document.getElementById("mic").onclick = ()=>{

const SpeechRecognition =
window.SpeechRecognition ||
window.webkitSpeechRecognition;

if(!SpeechRecognition){

alert("Voice recognition not supported in this browser");

return;

}

const recognition = new SpeechRecognition();

recognition.lang="en-US";

recognition.start();

recognition.onresult=(event)=>{

input.value =
event.results[0][0].transcript;

sendMessage();

};

};

</script>


</body>
</html>
