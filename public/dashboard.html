<!DOCTYPE html>
<html>
<head>
<title>SnowSkye Dashboard</title>

<style>

body{
font-family:Arial;
background:#0f172a;
color:white;
padding:20px;
}

.box{
background:#1e293b;
padding:20px;
margin-top:20px;
border-radius:10px;
}

button{
background:#2563eb;
color:white;
border:none;
padding:10px;
margin-top:10px;
cursor:pointer;
}

.delete{
background:red;
}

textarea,input{
width:100%;
padding:10px;
margin-top:10px;
}

.lead{
background:#020617;
padding:15px;
margin-top:10px;
border-radius:8px;
border-left:4px solid #38bdf8;
}

.time{
color:#94a3b8;
font-size:12px;
margin-top:5px;
}

</style>

</head>
<body>

<h1>SnowSkye Dashboard</h1>


<!-- CLIENT INFO -->
<div class="box">

<h3>Email</h3>
<input id="email" readonly>

<h3>API Key</h3>
<input id="apiKey" readonly>

</div>



<!-- AI PROMPT -->
<div class="box">

<h3>Edit AI Personality</h3>

<textarea id="prompt"></textarea>

<button onclick="savePrompt()">
Save Prompt
</button>

</div>



<!-- INSTALL CODE -->
<div class="box">

<h3>Install Code</h3>

<textarea id="install"></textarea>

</div>



<!-- LEADS SECTION -->
<div class="box">

<h3>ðŸ¦· Captured Leads</h3>

<div id="leads">
Loading leads...
</div>

</div>



<!-- DELETE -->
<div class="box">

<h3>Danger Zone</h3>

<button class="delete"
onclick="deleteAccount()">
Delete Account
</button>

</div>



<script>

const API_URL =
"https://lead-chatbot-gti5.onrender.com";

const apiKey =
localStorage.getItem("snowskye_api_key");



/* ===========================
LOAD CLIENT INFO
=========================== */

fetch(API_URL+"/api/get-client",{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({ apiKey })

})
.then(res=>res.json())
.then(data=>{

document.getElementById("email").value =
data.email;

document.getElementById("apiKey").value =
data.api_key;

document.getElementById("prompt").value =
data.ai_prompt;

document.getElementById("install").value =
`<script src="${API_URL}/widget.js" data-api-key="${apiKey}"></script>`;

});



/* ===========================
LOAD LEADS
=========================== */

function loadLeads(){

fetch(API_URL+"/leads")
.then(res=>res.json())
.then(data=>{

const container =
document.getElementById("leads");

container.innerHTML="";

const clientLeads =
data.filter(l=>l.apiKey===apiKey);

if(clientLeads.length===0){

container.innerHTML="No leads yet.";

return;

}

clientLeads.reverse().forEach(lead=>{

const div=document.createElement("div");

div.className="lead";

div.innerHTML=`

<div>${lead.message.replace(/\n/g,"<br>")}</div>

<div class="time">
${new Date(lead.time).toLocaleString()}
</div>

`;

container.appendChild(div);

});

});

}


loadLeads();

setInterval(loadLeads,5000);



/* ===========================
SAVE PROMPT
=========================== */

function savePrompt(){

const ai_prompt =
document.getElementById("prompt").value;

fetch(API_URL+"/api/update-prompt",{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({

apiKey,
ai_prompt

})

})
.then(()=>alert("Saved"));

}



/* ===========================
DELETE ACCOUNT
=========================== */

function deleteAccount(){

if(!confirm("Are you sure?"))
return;

fetch(API_URL+"/api/delete-account",{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({ apiKey })

})
.then(()=>{

alert("Deleted");

localStorage.removeItem(
"snowskye_api_key"
);

location.reload();

});

}

</script>

</body>
</html>
