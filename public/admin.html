<!DOCTYPE html>
<html>
<head>

<title>SnowSkye AI Admin</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>

body{
  background:#0f172a;
  color:#f1f5f9;
  font-family:Arial;
  margin:0;
  padding:20px;
}


/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}


h1{
  margin:0;
}


/* BUTTONS */
button{
  border:none;
  padding:8px 14px;
  border-radius:6px;
  cursor:pointer;
}


.export{
  background:#22c55e;
  color:white;
}


.logout{
  background:#334155;
  color:white;
}


/* SEARCH */
.searchBox{
  margin-bottom:15px;
}


input{
  padding:10px;
  border-radius:6px;
  border:none;
  width:250px;
}


/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  background:#1e293b;
  border-radius:10px;
  overflow:hidden;
}


th{
  background:#111827;
  padding:12px;
  text-align:left;
}


td{
  padding:12px;
  border-bottom:1px solid #334155;
}


tr:hover{
  background:#334155;
}


/* DELETE BUTTON */
.delete{
  background:#ef4444;
  color:white;
}


.count{
  margin-bottom:10px;
  color:#94a3b8;
}

</style>

</head>
<body>


<!-- HEADER -->
<div class="header">

<div>
<h1>SnowSkye AI Admin</h1>
<div class="count">
Total Leads: <span id="count">0</span>
</div>
</div>

<div>

<button class="export"
onclick="exportCSV()">
Export CSV
</button>

<button class="logout"
onclick="logout()">
Logout
</button>

</div>

</div>



<!-- SEARCH -->
<div class="searchBox">

<input
id="search"
placeholder="Search name or email..."
oninput="filterLeads()"
/>

</div>



<!-- TABLE -->
<table>

<thead>

<tr>

<th>Name</th>
<th>Email</th>
<th>Date</th>
<th>Action</th>

</tr>

</thead>

<tbody id="table">

</tbody>

</table>



<script>


let allLeads = [];



// ==========================
// LOAD LEADS
// ==========================
async function loadLeads(){

const res =
await fetch("/api/leads");

const leads =
await res.json();

allLeads = leads;

render(leads);

}



// ==========================
// RENDER TABLE
// ==========================
function render(leads){

document.getElementById(
"count"
).innerText = leads.length;


const table =
document.getElementById("table");

table.innerHTML = "";


if(leads.length===0){

table.innerHTML =
"<tr><td colspan='4'>No leads found</td></tr>";

return;

}


leads.forEach(lead=>{

const row =
document.createElement("tr");


row.innerHTML = `

<td>${lead.name || "-"}</td>

<td>${lead.email || "-"}</td>

<td>${new Date(
lead.created_at
).toLocaleString()}</td>

<td>

<button class="delete"
onclick="deleteLead('${lead.id}')">
Delete
</button>

</td>

`;

table.appendChild(row);

});

}



// ==========================
// FILTER
// ==========================
function filterLeads(){

const q =
document.getElementById("search")
.value.toLowerCase();


const filtered =
allLeads.filter(l =>

l.name?.toLowerCase().includes(q) ||
l.email?.toLowerCase().includes(q)

);

render(filtered);

}



// ==========================
// DELETE LEAD
// ==========================
async function deleteLead(id){

if(!confirm("Delete lead?"))
return;


await fetch(
"/admin/delete/" + id,
{
method:"POST"
}
);

loadLeads();

}



// ==========================
// EXPORT CSV
// ==========================
function exportCSV(){

window.location =
"/admin/export";

}



// ==========================
// LOGOUT
// ==========================
function logout(){

window.location =
"/logout";

}



// ==========================
// INIT
// ==========================
loadLeads();


</script>


</body>
</html>
