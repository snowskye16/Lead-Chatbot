<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>SnowSkye AI</title>

<style>

body{
margin:0;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
}

/* BUTTON */

#btn{
position:fixed;
bottom:20px;
right:20px;
width:60px;
height:60px;
background:#2563eb;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
cursor:pointer;
box-shadow:0 10px 25px rgba(0,0,0,0.3);
z-index:999999;
transition:.3s;
}

#btn img{
width:28px;
}

/* BADGE */

#badge{
position:absolute;
top:-5px;
right:-5px;
background:red;
color:white;
width:20px;
height:20px;
border-radius:50%;
font-size:12px;
display:none;
align-items:center;
justify-content:center;
}

/* CHAT */

#chat{
position:fixed;
bottom:90px;
right:20px;
width:380px;
height:550px;
background:white;
border-radius:16px;
box-shadow:0 15px 50px rgba(0,0,0,0.3);
display:none;
flex-direction:column;
overflow:hidden;
animation:fadeIn .25s;
}

@media(max-width:600px){

#chat{
width:100%;
height:100%;
bottom:0;
right:0;
border-radius:0;
}

}

/* HEADER */

#header{
background:#2563eb;
color:white;
padding:12px;
display:flex;
align-items:center;
justify-content:space-between;
}

#header-left{
display:flex;
align-items:center;
gap:10px;
}

#header img{
height:32px;
}

#close{
cursor:pointer;
font-size:18px;
}

/* MESSAGES */

#messages{
flex:1;
padding:15px;
overflow-y:auto;
background:#f1f5f9;
}

/* MESSAGE */

.row{
display:flex;
gap:8px;
margin-bottom:10px;
}

.row.user{
justify-content:flex-end;
}

.avatar{
width:32px;
height:32px;
border-radius:50%;
}

.bubble{
padding:10px 14px;
border-radius:12px;
max-width:70%;
font-size:14px;
}

.bot .bubble{
background:#e2e8f0;
}

.user .bubble{
background:#2563eb;
color:white;
}

/* INPUT */

#input-area{
display:flex;
border-top:1px solid #eee;
}

#input{
flex:1;
padding:12px;
border:none;
outline:none;
}

#send{
background:#2563eb;
color:white;
border:none;
padding:12px 16px;
cursor:pointer;
}

/* TYPING */

.typing span{
width:6px;
height:6px;
background:#999;
display:inline-block;
border-radius:50%;
margin-right:3px;
animation:blink 1.4s infinite;
}

.typing span:nth-child(2){animation-delay:.2s}
.typing span:nth-child(3){animation-delay:.4s}

@keyframes blink{
0%,80%,100%{opacity:0}
40%{opacity:1}
}

@keyframes fadeIn{
from{opacity:0;transform:translateY(10px)}
to{opacity:1;transform:translateY(0)}
}

</style>

</head>
<body>

<!-- BUTTON -->

<div id="btn">

<img src="/logo.png">

<div id="badge">1</div>

</div>


<!-- CHAT -->

<div id="chat">

<div id="header">

<div id="header-left">
<img src="/logo.png">
SnowSkye AI
</div>

<div id="close">âœ•</div>

</div>

<div id="messages"></div>

<div id="input-area">

<input id="input" placeholder="Type message...">

<button id="send">Send</button>

</div>

</div>


<script>

const API_URL =
"https://lead-chatbot-gti5.onrender.com";

const API_KEY =
"sk-55c2d0e8-08b3-44af-aa9c-3329efacdcd2"; // CHANGE


const btn=document.getElementById("btn");
const chat=document.getElementById("chat");
const close=document.getElementById("close");
const input=document.getElementById("input");
const send=document.getElementById("send");
const messages=document.getElementById("messages");
const badge=document.getElementById("badge");

let unread=0;

// SESSION

let sessionId=
localStorage.getItem("snowskye_session");

if(!sessionId){

sessionId=
crypto.randomUUID();

localStorage.setItem(
"snowskye_session",
sessionId
);

}


// OPEN

btn.onclick=()=>{

chat.style.display="flex";

badge.style.display="none";

unread=0;

};


// CLOSE

close.onclick=()=>{

chat.style.display="none";

};


// ADD MESSAGE

function addMessage(text,user){

const row=
document.createElement("div");

row.className=
"row "+(user?"user":"bot");


const avatar=
document.createElement("img");

avatar.className="avatar";

avatar.src=
user?"/user.png":"/bot.png";


const bubble=
document.createElement("div");

bubble.className="bubble";


if(user){

bubble.innerText=text;

row.appendChild(bubble);
row.appendChild(avatar);

}else{

row.appendChild(avatar);
row.appendChild(bubble);

streamText(bubble,text);

}


messages.appendChild(row);

messages.scrollTop=
messages.scrollHeight;


// unread badge

if(chat.style.display!="flex" && !user){

unread++;

badge.innerText=unread;

badge.style.display="flex";

playSound();

}

}


// STREAM TEXT EFFECT

function streamText(element,text){

let i=0;

const speed=15;

function type(){

if(i<text.length){

element.innerHTML+=text.charAt(i);

i++;

setTimeout(type,speed);

}

}

type();

}


// TYPING

function showTyping(){

const row=document.createElement("div");

row.className="row bot";

row.id="typing";

row.innerHTML=`

<img src="/bot.png" class="avatar">

<div class="bubble typing">

<span></span>
<span></span>
<span></span>

</div>

`;

messages.appendChild(row);

}


function hideTyping(){

const t=document.getElementById("typing");

if(t)t.remove();

}


// SOUND

function playSound(){

const audio=
new Audio(
"https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"
);

audio.play();

}


// SEND MESSAGE

async function sendMessage(){

const text=input.value.trim();

if(!text)return;

addMessage(text,true);

input.value="";

showTyping();

try{

const res=
await fetch(
API_URL+"/chat",
{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
apiKey:API_KEY,
message:text,
sessionId
})
}
);

const data=
await res.json();

hideTyping();

addMessage(data.reply,false);

}
catch{

hideTyping();

addMessage(
"Connection error",
false
);

}

}


send.onclick=sendMessage;

input.onkeypress=e=>{
if(e.key==="Enter")
sendMessage();
};

</script>

</body>
</html>
